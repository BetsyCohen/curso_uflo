---
title: "Mapas"
subtitle: "Análisis de Datos 1 - Unidad 4"
author: "Betsy Cohen"
logo: "images/logo-uflo.png"
format:
  revealjs:
    width: 1600
    height: 900
    theme: slides.scss
    highlight-style: a11y
    transition: fade
    slide-number: true
execute:
  echo: true
df-print: kable
---

## El factor socio-territorial

Cuando analizamos procesos sociales la pregunta del **donde** es clave, lo cual hace de los mapas una herramienta fundamental. Algunos de los usos que podemos pensar en sociología son:

-   Socio urbana: Planificación gestión / usos del suelo / análisis de circulación
-   Socio política: Estudios electorales
-   Demografía
-   Socio económica
-   Gestión socio ambiental
-   Análisis de mercado/ de competencia
-   Sociología de la salud: análisis epidemiológico, asistencia

En R contamos con varios paquetes para la manipulación de datos espaciales

## Representar sobre un plano la Tierra y su superficie (irregular)

::: columns
::: {.column width="50%"}
-   Sistemas de coordenadas de referencia (CRS) (el más conocido lat-long)

-   **Proyecciones cartográficas**, instrucciones para traducir a un plano la disposición de puntos ubicados en la esfera terrestre.

    En toda proyección (como en cualquier traducción), los mapas, inevitablemente, son una versión distorsionada ya que no podemos pasar de la esfera al plano sin desformar la superficie, distancia.
:::

::: {.column width="50%"}
![](https://www.researchgate.net/profile/Bojan-Savric/publication/273517879/figure/fig1/AS:347863067447297@1459948426262/The-nine-small-scale-map-projections-used-in-the-paired-comparison-test-arranged-by.png){width="624"}
:::
:::

::: notes
La proyección más famosa es la Mercator, diseñada para asistir la navegación marítima y en uso desde el siglo XVI. Su fuerte es que no distorsiona las direcciones, por lo que permite fijar el rumbo de navegación consultando el mapa. Su principal problema es que produce una distorsión notable en las áreas cercanas a los polos: Groenlandia aparenta el mismo tamaño que toda África, cuando en realidad tiene sólo un quinceavo de su superficie. Por esa razón perdió la proyección popularidad en el siglo XX cuando comenzaron a preferirse proyecciones que respetan las áreas. Sin embargo, en el siglo XXI la proyección Mercator recuperó protagonismo. Google la eligió para sus mapas en línea, y por razones de compatibilidad otros proveedores de mapas digitales la adoptaron también. Así, y para inconsolable irritación de los geógrafos, Mercator se convirtió en el estándar de facto para aplicaciones geográficas en la web.

En la práctica, si trabajamos en forma frecuente con archivos georreferenciados vamos a sufrir tarde o temprano de problemas de coordenadas o proyección. El más común de ellos: tener una fuentes de datos geográficos que no podemos comparar con otras, porque desconocemos el sistema de coordenadas que se usó para crearla; es decir, no podemos saber a que posición sobre el planeta corresponde cada observación en los datos.
:::

## Tipo de datos {auto-animate="true" auto-animate-easing="ease-in-out"}

::: r-hstack
::: {data-id="puntos" auto-animate-delay="0"}
![](https://ecologiaysig.files.wordpress.com/2019/06/3-0-e1560499500941.png){style="width: 150px"}
:::

::: {data-id="lineas" auto-animate-delay="0.1"}
![](https://ecologiaysig.files.wordpress.com/2019/06/3-0-4-e1560500550761.png){style="width: 150px"}
:::

::: {data-id="poligonos" auto-animate-delay="0.2"}
![](https://ecologiaysig.files.wordpress.com/2019/06/3-0-5-e1560503530889.png){style="width: 150px"}
:::
:::

## Tipo de datos {auto-animate="true" auto-animate-easing="ease-in-out"}

::: r-stack
::: {data-id="puntos"}
![](https://ecologiaysig.files.wordpress.com/2019/06/3-0-e1560499500941.png){style="width: 150px"}
:::

::: {data-id="lineas"}
![](https://ecologiaysig.files.wordpress.com/2019/06/3-0-4-e1560500550761.png){style="width: 150px;"}
:::

::: {data-id="poligonos"}
![](https://ecologiaysig.files.wordpress.com/2019/06/3-0-5-e1560503530889.png){style="width: 150px;"}
:::

::: {data-id="lineas"}
![](images/multipoligono){style="width: 250px;"}
:::
:::

## Formatos de archivos georreferenciados

-   shapefile: creado por ESRI (creadores de ArcGIS) tiene varios archivos que por lo general vienen combinados en un zip los nombres de las variables tienen que tener 10 caracteres o menos (la gente se pone creativa con las abreviaturas)

-   GeoJSON:una alteranriva más feliz y de código abierto que corrige estos problemas

-   KML/KMZ: el formato que usa Google Earth

-   csv: representando solamente lat y longitud (por lo cual solo podremos diubujar puntos y líneas)

## Tipos de mapas

-   Puntos
-   Coropletas
-   Graficos de burbujas en mapa
-   Conexiones
-   Cartogramas

## Mapa de puntos 

::: columns
::: {.column width="50%"}
Los mapas de puntos son una forma de detectar patrones espaciales o la distribución de datos en una región geográfica, colocando puntos de igual tamaño sobre una región geográfica.

Hay dos tipos de mapas de puntos: **uno a uno** (un punto representa un único recuento u objeto) y **uno a muchos** (un punto representa una unidad particular, por ejemplo, 1 punto = 10 árboles).

Los mapas de puntos son ideales para visualizar la distribución de los elementos en una región relevando patrones. 
:::

::: {.column width="50%"}
![](https://datavizcatalogue.com/methods/images/top_images/SVG/dot_map.svg)
:::
:::

## Coropletas

::: columns
::: {.column width="50%"}
Un mapa de coropletas es un tipo de mapa donde diferentes áreas geográficas se colorean en base a una variable asociada a esas áreas. Este tipo de gráfico proporciona de manera intuitiva cómo una determinada variable (la población, los ingresos, ...) varían entre las diferentes áreas.
:::

::: {.column width="50%"}
![](https://datavizcatalogue.com/methods/images/anatomy/choropleth.png)
:::
:::

## Mapa de burbujas {.nostretch}

::: columns
::: {.column width="50%"}
Un mapa de burbujas usa símbolos proporcionales para representar cómo una variable varía sobre diferentes áreas geográficas. El símbolo usado es por lo general un círculo, cuyo diámetro depende del valor de la variable de interés.

Son una buena alternativa a los mapas coropleticos pero una falla importante es que las burbujas demasiado grandes pueden superponerse a otras burbujas y regiones del mapa, por lo que esto debe tenerse en cuenta, ya que a veces podemos resolverlo con transparencias y a veces no.
:::

::: {.column width="50%"}

![](https://datavizcatalogue.com/methods/images/top_images/SVG/bubble_map.svg)
:::
:::

## Mapas de conexiones y mapas de flujos {.smaller}

::: columns
::: {.column width="50%"}
Los **mapas de conexión** se dibujan conectando puntos colocados en un mapa mediante líneas rectas o curvas.

Si bien los mapas de conexión son excelentes para mostrar conexiones y relaciones geográficamente, también pueden usarse para mostrar rutas a través de una sola cadena de enlaces. Además, pueden ser útiles para revelar patrones espaciales mediante la distribución de conexiones o su concentración en un mapa.
:::

::: {.column width="50%"}
Los **mapas de flujo** son parecidos a los mapas de conexiones pero incluyen además una tercera dimensión de magnitud.

Normalmente, se utilizan para mostrar datos sobre la migración de personas, animales y productos. La magnitud o cantidad de migración en una sola línea de flujo se representa mediante su grosor. Esto ayuda a mostrar cómo se distribuye geográficamente la migración.
:::
:::

::: columns

::: {.column width="50%"}
![](https://datavizcatalogue.com/methods/images/anatomy/SVG/connection_map.svg)
:::

::: {.column width="50%"}
![](https://datavizcatalogue.com/methods/images/anatomy/flow_map.png)
:::
:::

## Cartogramas

::: columns
::: {.column width="50%"}
Un cartograma es un tipo de mapa donde diferentes áreas geográficas son modificadas en base a una variable asociada a esas áreas. Aunque los cartogramas pueden ser visualmente atractivos, requieren un conocimiento previo de la geografía representada, ya que los tamaños y los límites de las geografías son alterados.
:::

::: {.column width="50%"}
![](https://r-charts.com/es/espacial/cartograma-ggplot2_files/figure-html/cartograma-ggplot2.png){width="533"}
:::
:::


## Librerías para hacer mapas

Existen muchas libreìas para hacer gráficos hoy vamos a ver tres

`sf{}`(simple shapes): que nos ayuda en la initerpretación geométrica del multipoligono
`gglot` que nos va a servir para hacer mapas estáticos
`leaflet` para hacer gráficos dinámicos en java


## Geodesias y poligonos de Argentina

El Instituto Geográfico Nacional nos provee en su web los archivos para dibujar la forma de nuestro país. 
Todas las capas GIS podes encontrarlas en [https://www.ign.gob.ar/NuestrasActividades/InformacionGeoespacial/CapasSIG](https://www.ign.gob.ar/NuestrasActividades/InformacionGeoespacial/CapasSIG). 

En este caso nosotros estamos escogiendo la capa Polígono de límites de Provincia.
Escogimos descargarlo en formato csv pero también se encuentran disponibles los Shapefiles,
KML y GeoJSON.

Cargamos la geodesia

```{r}
library(tidyverse)
library(sf)


summary(provincias)
```


```{r}
bibliotecas <- read.csv("https://datos.cultura.gob.ar/dataset/37305de4-3cce-4d4b-9d9a-fec3ca61d09f/resource/01c6c048-dbeb-44e0-8efa-6944f73715d7/download/bibliotecas-populares.csv")

bibliotecas_con_geo <- bibliotecas %>%
  left_join(provincias, by = c("id_provincia" = "in1")) 

summary(bibliotecas_con_geo)
```



```{r}

bibliotecas_con_geo %>% 
  ggplot() 
ggplot() + geom_sf(data = bibliotecas_con_geo)
```


hoy vamos a trabajar

```{r}
# library(tidyverse)



```

## Mapas con ggplot

## Mapas con `leaflet`

El paquete leaflet permite crear mapas dinámicos e interactivos utilizando la librería Leaflet de JavaScript La principal ventaja de utilizar leaflet frente a otras alternativas es su flexibilidad y que su implementación en R es realmente sencilla de usar.
