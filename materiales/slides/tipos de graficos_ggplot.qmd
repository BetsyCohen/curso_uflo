---
title: "Tipos de gr√°ficos y sus usos"
subtitle: "An√°lisis de Datos 1 - Unidad 4"
author: "Betsy Cohen"
logo: "images/logo-uflo.png"
format:
  revealjs:
    width: 1600
    height: 900
    theme: slides.scss
    highlight-style: a11y
    transition: fade
    slide-number: true
execute:
  echo: true
df-print: kable
---

```{r}
#| context: setup
#| include: false

library(tidyverse)
library(scales)
library(ggplot2)
library(waffle)
library(treemapify)
library(eph)

library(showtext)

font_add_google("Poppins")
font_add_google("Montserrat")

showtext_auto()

theme_uflo <- function() {
  titles_font_family <- "Poppins"
  base_font_family <- "Montserrat"

  theme_minimal() +
    theme(
      # Leyenda
      legend.position = "left",
      legend.text = element_text(family = base_font_family),
      legend.title = element_text(family = titles_font_family),

      # Grid
      panel.grid.major = element_line(linewidth = 0.25, color = "#F3F3F3"),
      panel.grid.major.x = element_blank(),
      panel.grid.minor = element_blank(),
      panel.spacing = unit(0.75, "lines"),
      panel.background = element_rect(fill = "transparent", color = "transparent"),

      # Ejes
      axis.title = element_text(family = titles_font_family),
      axis.text = element_text(family = base_font_family),

      # Facetas
      strip.text = element_text(family = titles_font_family, hjust = 0, color = "white", size = 12),
      strip.background = element_rect(fill = "black"),

      # Texto
      text = element_text(family = base_font_family, size = 15, color = "black"),

      # Aspectos principales
      plot.title = element_text(family = titles_font_family, size = 30),
      plot.subtitle = element_text(family = titles_font_family, color = "#8a8a8a", size = 15),
      plot.caption = element_text(family = titles_font_family),
      plot.background = element_rect(fill = "transparent", color = "transparent")
    )
}

theme_set(theme_uflo())

```

# Comunicar con gr√°ficos üìä

En la clase de hoy, nos adentraremos en el mundo de la visualizaci√≥n de datos con R, una habilidad crucial para explorar patrones, comunicar hallazgos y respaldar nuestros an√°lisis en de datos. Nos enfocaremos en los tipos de gr√°ficos m√°s comunes y en la introducci√≥n al potente paquete `ggplot2`.

# Tipos de Gr√°ficos Comunes y sus Usos üìä

La elecci√≥n del gr√°fico adecuado es fundamental para transmitir la informaci√≥n de manera efectiva, pero ¬øC√≥mo saber cu√°l necesito? En esta primera secci√≥n repasamos algunos de los tipos de gr√°ficos m√°s utilizados en el an√°lisis de datos.

## Respeten los rangos: Gr√°ficos para variables categ√≥ricas {.smaller}

**Gr√°fico de columnas / barras**

Donde vamos a poder mostrar la distribuci√≥n de una frecuencia para cada categor√≠a. En el gr√°fico de barras las categor√≠as se indican en el eje X mientras que en el de barras se ubican en el eje Y (dejando el el eje X para los valores de la n distribuci√≥n)

```{r}
#| code-fold: true

starwars %>%
  select(name, gender) %>% 
  group_by(gender) %>%
  summarise(count = n(), .groups = "drop") %>%
  ggplot(aes(x = gender, y = count)) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(
    title = "Cantidad de personajes por g√©nero en peliculas de Starwars",
    x = "G√©nero",
    y = "Cantidad de personajes"
  ) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

```

## Apilar y agrupar {.smaller}

Un recurso que tambi√©n podemos usar es mostrar las barras agrupadas o apiladas en funci√≥n de una **segunda variable categ√≥rica** esto tambi√©n nos ayuda a entender la distribuci√≥n como parte de un todo dentro de esa categor√≠a en particular.

::: columns
::: {.column width="50%"}
```{r}
#| code-fold: true
starwars %>%
  select(name, gender, films) %>% 
  unnest(films) %>% 
  group_by(films, gender) %>%
  summarise(count = n(), .groups = "drop") %>%
  ggplot(aes(x = films, y = count, fill = gender)) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(
    title = "Personajes de Star Wars por g√©nero",
    subtitle = "Barras agrupadas",
    x = "Pel√≠cula",
    y = "Cantidad de personajes",
    fill = "G√©nero"
  ) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

```
:::

::: {.column width="50%"}
```{r}
#| code-fold: true
library(ggplot2)

starwars %>%
  select(name, gender, films) %>% 
  unnest(films) %>% 
  group_by(films, gender) %>%
  summarise(count = n(), .groups = "drop") %>%
  ggplot(aes(x = films, y = count, fill = gender)) +
  geom_bar(stat = "identity") +  # <- apiladas por default
  labs(
    title = "Personajes de Star Wars por g√©nero",
    subtitle = "Barras apiladas",
    x = "Pel√≠cula",
    y = "Cantidad de personajes",
    fill = "G√©nero"
  ) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))



```
:::
:::

## Algunas alternativas a los gr√°ficos de barra {.smaller}

```{r}
#| code-fold: true
starwars %>%
  filter(!is.na(eye_color)) %>%
  count(eye_color, name = "cantidad") %>%
  ggplot(aes(x = reorder(eye_color, cantidad), y = cantidad)) +
  geom_segment(aes(xend = eye_color, y = 0, yend = cantidad), color = "gray") +
  geom_point(size = 4, color = "steelblue") +
  coord_flip() +
  labs(
    title = "Personajes en Star Wars por color de sus ojos ",
    x = "Color de ojos",
    y = "Cantidad"
  ) 
```

## ü•ß Graficos de torta y donna {.smaller}

Los gr√°ficos de torta y donna tambi√©n nos permiten ver la distribuci√≥n de una variable categ√≥rica.

::: columns
::: {.column width="50%"}
```{r}
#| code-fold: true
starwars %>%
  filter(!is.na(gender)) %>%
  count(gender, name = "cantidad") %>%
  ggplot(aes(x = "", y = cantidad, fill = gender)) +
  geom_bar(stat = "identity", width = 1) +
  coord_polar("y") +
  labs(
    title = "Personajes de Star Wars por g√©nero",
    fill = "G√©nero"
  ) 
```
:::

::: {.column width="50%"}
```{r}
#| code-fold: true
starwars %>%
  filter(!is.na(gender)) %>%
  count(gender, name = "cantidad") %>%
  ggplot(aes(x = 2, y = cantidad, fill = gender)) +
  geom_bar(stat = "identity", width = 1, color = "white") +
  coord_polar("y", start = 0) +
  xlim(0.5, 2.5) +
  labs(
    title = "Personajes de Star Wars por g√©nero",
    fill = "G√©nero"
  ) +
  theme(plot.title = element_text(hjust = 0.5))
```
:::
:::

::: callout-warning
Los gr√°ficos de torta son muy criticados en la visualizaci√≥n de datos ya que pueden prestar a la confusi√≥n y no podemos tampoco meter m√°s de 5 categor√≠as (sino es ilegible). Usalos con precauci√≥n o, mejor a√∫n, utiliza alternativas como gr√°ficos de barras, diagramas de chupetin, diagramas de √°rbol y otros.
:::

## üå≥ Parte de un todo: √°rboles y waffles

Cuando queremos mostrar una distribuci√≥n de una variable de categ√≥ricas una buena alternativa son los treemaps y los gr√°ficos de waffles

::: columns
::: {.column width="50%"}
```{r}
#| code-fold: true
#| warning: false

# Preparamos los datos
generos <- starwars %>%
  filter(!is.na(gender)) %>%
  count(gender, name = "cantidad") %>%
  arrange(desc(cantidad))

# Gr√°fico waffle
waffle::waffle(
  parts = setNames(generos$cantidad, generos$gender),
  rows = 10,
  title = "Personajes por g√©nero",
  colors = RColorBrewer::brewer.pal(n = nrow(generos), name = "Set2")
)+ theme_uflo()


```
:::

::: {.column width="50%"}
```{r}
#| code-fold: true
starwars %>%
  filter(!is.na(eye_color)) %>%
  count(eye_color, name = "cantidad") %>%
  ggplot(aes(area = cantidad, fill = eye_color, label = paste(eye_color, cantidad))) +
  geom_treemap() +
  geom_treemap_text(colour = "white", place = "centre", grow = TRUE) +
  labs(
    title = "Personajes por color de ojos ",
    fill = "Color de ojos"
  ) 
```
:::
:::

## ‚è≤Ô∏è Evoluci√≥n en el tiempo {.smaller}

Cuando queremos ver la evoluci√≥n de una variable continua en el tiempo, las opciones m√°s habituales son los gr√°ficos de l√≠nea

```{r}
#| code-fold: true
#| warning: false
lineas <- get_poverty_lines()

lineas %>%
  select(-ICE) %>%
  pivot_longer(cols = c("CBA", "CBT"), names_to = "canasta", values_to = "valor") %>%
  ggplot() +
  geom_line(aes(x = periodo, y = valor, col = canasta))+
  labs(
    title = "Canastas basica alimentaria y canasta total",
    subtitle = "Encuesta Permanente de Hogares INDEC",
    fill = "Color de ojos"
  ) 


```

## ‚è≤Ô∏è Evoluci√≥n en el tiempo

Un ejemplo que combina proporci√≥n y evoluci√≥n temporal es el gr√°fico de √°reas:

```{r}
#| code-fold: true

pop_data <- gapminder::gapminder %>%
  group_by(year, continent) %>%
  summarise(total_pop = sum(pop), .groups = "drop")

ggplot(pop_data, aes(x = year, y = total_pop, fill = continent))+
  geom_area(alpha = 0.8, color = "white")+
  scale_y_continuous(labels = label_number(scale = 1e-9, suffix = "B"))+
  labs(
    title = "Evolucion de la poblacion total por continente",
    subtitle = "Fuente Gapminder",
    x = "A√±o",
    y = "poblaci√≥n (en miles de millones",
    fill = "Continentes"
  )

```

## Gr√°ficos de Distribuci√≥n

::: panel-tabset
### üìä Histogramas

Un histograma se utiliza para mostrar la distribuci√≥n de frecuencia de una variable num√©rica. **Divide los datos en intervalos** (bins) y la altura de cada barra representa la cantidad de observaciones que caen dentro de ese intervalo, permitiendo ver la forma de la distribuci√≥n.

```{r}
#| code-fold: true

ggplot(gapminder::gapminder, aes(x = lifeExp)) +
  geom_histogram(binwidth = 5, fill = "steelblue", color = "white") +
  labs(
    title = "Histograma de la esperanza de vida",
    x = "Esperanza de vida",
    y = "Frecuencia"
  )
```

### üí† Gr√°fico de Densidad

Este gr√°fico proporciona una **estimaci√≥n suavizada** de la funci√≥n de densidad de probabilidad de una variable num√©rica. Es √∫til para visualizar la forma general de la distribuci√≥n y compararla entre diferentes grupos.

```{r}
#| code-fold: true
ggplot(gapminder::gapminder, aes(x = lifeExp, fill = continent)) +
  geom_density(alpha = 0.6) +
  labs(
    title = "Densidad de esperanza de vida por continente",
    x = "Esperanza de vida",
    y = "Densidad",
    fill = "Continente"
  )
```

### üì¶ Boxplot (Diagrama de Caja y Bigotes):

Un boxplot **resume** la distribuci√≥n de una variable num√©rica a trav√©s de sus **cuartiles**, la mediana y posibles valores at√≠picos (outliers). Es especialmente √∫til para comparar la distribuci√≥n de una variable entre diferentes grupos o categor√≠as.

```{r}
#| code-fold: true
ggplot(gapminder::gapminder, aes(x = continent, y = gdpPercap, fill = continent)) +
  geom_boxplot() +
  scale_y_log10() +  # Escala logar√≠tmica para ver mejor los valores extremos
  labs(
    title = "Distribuci√≥n del PBI per c√°pita por continente",
    x = "Continente",
    y = "PBI per c√°pita (escala log)"
  )
```
:::

## Gr√°ficos de Correlaci√≥n

::: panel-tabset
### üéØ Scatter Plot

Un gr√°fico de dispersi√≥n se utiliza para mostrar la relaci√≥n entre dos variables num√©ricas. Cada punto en el gr√°fico representa una observaci√≥n, y la posici√≥n del punto en los ejes horizontal y vertical indica los valores de las dos variables, permitiendo identificar patrones de correlaci√≥n (positiva, negativa o sin correlaci√≥n).

```{r}
#| code-fold: true

ggplot(gapminder::gapminder, aes(x = gdpPercap, y = lifeExp, color = continent)) +
  geom_point(alpha = 0.6) +
  scale_x_log10() +
  labs(
    title = "Relaci√≥n entre PBI per c√°pita y esperanza de vida",
    x = "PBI per c√°pita (log)",
    y = "Esperanza de vida",
    color = "Continente"
  )
```

### üå°Ô∏è Heatmap

Un mapa de calor visualiza la magnitud de una variable como un color en una matriz. Es √∫til para mostrar patrones de correlaci√≥n entre m√∫ltiples variables (donde la intensidad del color representa la fuerza de la correlaci√≥n) o para visualizar datos geogr√°ficos (donde el color representa la magnitud de una variable en diferentes √°reas).

```{r}
#| code-fold: true

selected_countries <- gapminder::gapminder %>%
  group_by(country) %>%
  summarise(mean_lifeExp = mean(lifeExp)) %>%
  top_n(15, mean_lifeExp) %>%
  pull(country)

gap_heatmap <- gapminder::gapminder %>%
  filter(country %in% selected_countries)

ggplot(gap_heatmap, aes(x = factor(year), y = country, fill = lifeExp)) +
  geom_tile() +
  scale_fill_viridis_c() +
  labs(
    title = "Heatmap de esperanza de vida por pa√≠s y a√±o",
    x = "A√±o",
    y = "Pa√≠s",
    fill = "Esperanza de vida"
  ) 
```

### ü´ß Gr√°fico de Burbujas

Un gr√°fico de burbujas extiende el gr√°fico de dispersi√≥n al a√±adir una tercera variable que se representa mediante el tama√±o de las burbujas. Esto permite visualizar la relaci√≥n entre tres variables simult√°neamente.

```{r}
#| code-fold: true

ggplot(gapminder::gapminder %>% filter(year == 2007),
       aes(x = gdpPercap, y = lifeExp, size = pop, color = continent)) +
  geom_point(alpha = 0.7) +
  scale_x_log10() +
  labs(
    title = "Relaci√≥n entre PBI, esperanza de vida y poblaci√≥n (2007)",
    x = "PBI per c√°pita (log)",
    y = "Esperanza de vida",
    size = "Poblaci√≥n",
    color = "Continente"
  )

```
:::

## Para ir resumiendo

En esta primera parte, exploramos una variedad de gr√°ficos comunes y sus usos principales en el an√°lisis de datos.

-   los gr√°ficos de **ranking** nos ayudan a comparar **magnitudes entre categor√≠as**

-   los gr√°ficos de "**parte del todo**" nos muestran **la composici√≥n de un total**

-   los gr√°ficos de **evoluci√≥n** ilustran tendencias a lo largo del tiempo,

-   los gr√°ficos de distribuci√≥n nos permiten entender la forma en que se **distribuyen** los datos **num√©ricos**

-   y los gr√°ficos de **correlaci√≥n** nos ayudan a identificar **relaciones** entre variables.

## ü§î Preguntas para pensar

-   Si quisieras comparar la cantidad de personas que prefieren diferentes partidos pol√≠ticos en una encuesta, ¬øqu√© tipo de gr√°fico ser√≠a m√°s apropiado?

<!-- -->

-   ¬øQu√© gr√°fico utilizar√≠as para mostrar c√≥mo ha cambiado la tasa de pobreza en un pa√≠s durante los √∫ltimos 20 a√±os?

<!-- -->

-   Imagina que tienes datos sobre el gasto total de un gobierno y quieres mostrar c√≥mo se distribuye ese gasto entre diferentes √°reas como educaci√≥n, salud y defensa. ¬øQu√© tipo de gr√°fico ser√≠a √∫til?

<!-- -->

-   ¬øQu√© tipo de gr√°fico te permitir√≠a identificar si existe una relaci√≥n entre el nivel de ingresos de las personas y su nivel de estudios?

<!-- -->

-   Si tuvieras un texto con las respuestas de una pregunta abierta en una encuesta, ¬øqu√© tipo de visualizaci√≥n te ayudar√≠a a identificar los temas m√°s recurrentes?
