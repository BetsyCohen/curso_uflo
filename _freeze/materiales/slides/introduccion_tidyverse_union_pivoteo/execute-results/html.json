{
  "hash": "2fb1dd0f8af55ab5c917709a12e9e9fa",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Introducci贸n a Tidyverse: union y pivoteo de tablas\"\nsubtitle: \"An谩lisis de Datos 1 - Unidad 3\"\nauthor: \"Betsy Cohen\"\nlogo: \"images/logo-uflo.png\"\ndate: \"04/10/2025\"\nformat:\n  revealjs:\n    width: 1600\n    height: 900\n    theme: slides.scss\n    highlight-style: a11y\n    transition: fade\n    slide-number: true\nexecute:\n  echo: true\ndf-print: kable\n---\n\n\n\n\n## Clase de Hoy: M谩s All谩 de los Verbos B谩sicos \n\nEn la clase anterior, nos familiarizamos con los verbos esenciales del `dplyr` y c贸mo combinarlos con pipes para transformar datos.\n\nAhora, vamos a expandir nuestro arsenal de herramientas del tidyverse explorando dos operaciones fundamentales:\n\n-   Uni贸n de Tablas (Joins): Combinar datos de m煤ltiples tablas relacionadas.\n\n-   Pivoteo de Tablas (Pivoting): Reorganizar la estructura de las tablas para facilitar el an谩lisis.\n\nEstas operaciones son clave para trabajar con conjuntos de datos complejos y cuando quieras darte cuenta van a ser parte de tu trabajo diario con datos.\n\n## Que las tablas sean unidas porque esa es la ley primera\n\nConociendo la familia de funciones join()\n\n## Qu茅 es un join()\n\nEn el an谩lisis de datos, a menudo tenemos informaci贸n distribuida en m煤ltiples tablas relacionadas y necesitamos unirlas para combinar la informaci贸n y poder analizarla en conjunto.\n\nEjemplo:\n\n**Tabla 1:** `encc_personas_region`: Informaci贸n agregada por regi贸n\n\n**Tabla 2:** `tamanio_localidad_region`: Informaci贸n sobre el tama帽o de localidad por regi贸n\n\nQueremos unir estas tablas para tener en una sola tabla informaci贸n combinada por regi贸n.\n\n## Que tipos de join() existen {.smaller}\n\n`dplyr` nos ofrece una familia de funciones \\*\\*\\*\\_join()\\*\\* para realizar diferentes tipos de uniones de tablas, basadas en la l贸gica de las bases de datos relacionales. Los principales tipos son:\n\n|                                                                                                                                                                                                          |                                                                               |\n|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------|\n| **left_join:** Mantiene TODAS las filas de tabla_A (izquierda) y agrega las columnas correspondientes de tabla_B donde hay coincidencia en la columna_clave. Si no hay coincidencia, se completa con NA. | ![](images/left-join.gif){fig-align=\"center\" fig-align=\"bottom\" width=\"200\"}  |\n| **right_join:** Similar a left_join, pero mantiene TODAS las filas de tabla_B (derecha) y agrega las columnas de tabla_A donde hay coincidencia.                                                         | ![](images/right-join.gif){fig-align=\"center\" fig-align=\"bottom\" width=\"200\"} |\n\n## Que tipos de join() existen {.smaller}\n\n`dplyr` nos ofrece una familia de funciones \\*\\*\\*\\_join()\\*\\* para realizar diferentes tipos de uniones de tablas, basadas en la l贸gica de las bases de datos relacionales. Los principales tipos son:\n\n|                                                                                                                                                                                                |                                                            |\n|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------|\n| **inner_join:** Mantiene solo las filas que tienen coincidencia en la columna_clave en AMBAS tablas.Es la intersecci贸n de las tablas.                                                          | ![](images/inner-join.gif){fig-align=\"bottom\" width=\"200\"} |\n| **full_join:** Uni贸n COMPLETA (EXTERNA). Mantiene TODAS las filas de AMBAS tablas, combinando las filas donde hay coincidencia y rellenando con NA donde no la hay. Es la uni贸n de las tablas. | ![](images/full-join.gif){fig-align=\"bottom\" width=\"200\"}  |\n\n## Otros tipos de join\n\n::: callout-note\n**semi_join** Uni贸n SEMI-IZQUIERDA. Mantiene solo las filas de tabla_A que tienen coincidencia en la columna_clave en tabla_B, pero NO agrega las columnas de tabla_B. Sirve para filtrar tabla_A bas谩ndose en la presencia de coincidencias en tabla_B.\n\n**anti_join** Uni贸n ANTI-IZQUIERDA. Mantiene solo las filas de tabla_A que NO tienen coincidencia en la columna_clave en tabla_B. Sirve para filtrar tabla_A y quedarte solo con las filas sin coincidencias en tabla_B.\n:::\n\n## 驴C贸mo Unimos Tablas con dplyr? 锔\n\nTodas las funciones \\*\\_join() de dplyr comparten una sintaxis similar:\n\n``` r\nnueva_tabla_unida <- tabla_A %>%\ntipo_de_join(tabla_B, by = \"columna_clave\")\n```\n\n-   `tabla_A %>% tipo_de_join(tabla_B, ...)`: Siempre empezamos con la tabla \"izquierda\" `(tabla_A)` y la \"pipeamos\" a la funci贸n `tipo_de_join()`.\n\n-   `tabla_B`: Es la tabla \"derecha\" que queremos unir a `tabla_A`.\n\n-   `by = \"columna_clave\"`: CLAVE DE UNIN. Especificamos qu茅 columna (o columnas) se utilizan para encontrar las coincidencias entre las filas de tabla_A y tabla_B. Las tablas se unir谩n bas谩ndose en los valores compartidos en esta columna. El nombre de la columna clave debe ser el mismo en ambas tablas, o podemos usar `by = c(\"columna_A\" = \"columna_B\")` si tienen nombres diferentes.\n\n## Ejemplo de left_join() 猬锔 {.smaller .scrollable}\n\nVamos a asumir que `encc_personas_region` es nuestra tabla \"principal\" (izquierda) y queremos agregarle informaci贸n de `tamanio_localidad_region` (tabla derecha), manteniendo todas las regiones de `encc_personas_region`:\n\nDe nuevo partimos de:\n\n::: columns\n::: {.column width=\"40%\"}\n\n::: {.cell}\n\n```{.r .cell-code}\nhead(encc_personas_region,3)\n```\n\n::: {.cell-output-display}\n<div class=\"kable-table\">\n\n|region | total_personas|\n|:------|--------------:|\n|CABA   |            388|\n|CENTRO |            608|\n|CUYO   |            431|\n\n</div>\n:::\n:::\n\n:::\n\n::: {.column width=\"60%\"}\n\n::: {.cell}\n\n```{.r .cell-code}\nhead(tamanio_localidad_region,3)\n```\n\n::: {.cell-output-display}\n<div class=\"kable-table\">\n\n|region | Mas de 400mil| 80mil a 400mil| Menos 80mil|\n|:------|-------------:|--------------:|-----------:|\n|CABA   |           388|              0|           0|\n|CENTRO |           382|            206|          20|\n|CUYO   |           308|            105|          18|\n\n</div>\n:::\n:::\n\n:::\n:::\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntabla_left_join <- encc_personas_region %>% # tabla de la izquierda\n  left_join(tamanio_localidad_region, by = \"region\") # unir tabla de la derecha usando como clave la variable \"Region\"\n\ntabla_left_join\n```\n\n::: {.cell-output-display}\n<div class=\"kable-table\">\n\n|region    | total_personas| Mas de 400mil| 80mil a 400mil| Menos 80mil|\n|:---------|--------------:|-------------:|--------------:|-----------:|\n|CABA      |            388|           388|              0|           0|\n|CENTRO    |            608|           382|            206|          20|\n|CUYO      |            431|           308|            105|          18|\n|GBA       |            620|           614|              5|           1|\n|NEA       |            448|             0|            354|          94|\n|NOA       |            446|           181|            177|          88|\n|PATAGONIA |            439|           103|            295|          41|\n\n</div>\n:::\n:::\n\n\n## Elegir el Tipo de Join Correcto  {.incremental .smaller}\n\nLa elecci贸n del tipo de join depende de lo que quieras lograr en tu an谩lisis.\n\n-   `inner_join():` Cuando necesitas datos completos y solo te interesan las filas que tienen informaci贸n en ambas tablas. \"Intersecci贸n\".\n\n-   `left_join():` Cuando quieres mantener todos los datos de tu tabla principal (izquierda) y agregar informaci贸n complementaria de otra tabla (derecha), aunque falte informaci贸n en la tabla derecha para algunas filas. \"Prioriza la tabla izquierda\".\n\n-   `right_join():` Similar a left_join, pero priorizando la tabla derecha. Menos com煤n en la pr谩ctica.\n\n-   `full_join():` Cuando quieres mantener todos los datos de ambas tablas, incluso si no hay coincidencias. \"Uni贸n completa\".\n\n-   `semi_join()` y `anti_join():` Para filtrar una tabla bas谩ndote en la existencia o no existencia de coincidencias en otra tabla. No agregan columnas, solo filtran filas.\n\n::: callout-tip\n## Tip anal贸gico\n\nA veces llegar a una tabla / resultados puede requerir de m煤ltiples uniones y transformaciones en el medio. Dibujar en papel o una pizarra las tablas puede ser de gran ayuda en este proceso.\n:::\n\n## Yo soy al derecho dado vuelta estas vos\n\nLas funciones `pivot_longer()` y `pivot_wider()`\n\n## Situaciones que requieren cintura {.smaller}\n\nMuchas veces nos va a pasar que vamos a tener una tabla en la cual las categor铆as que queremos mostrar (por ejemplo sexo, edad, provincia) se encuentran como nombres de columnas. Por ejemplo:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nencc_personas_por_genero_region\n```\n\n::: {.cell-output-display}\n<div class=\"kable-table\">\n\n|region    | Mujer| Var贸n| No binario|\n|:---------|-----:|-----:|----------:|\n|CABA      |   215|   173|         NA|\n|CENTRO    |   368|   240|         NA|\n|CUYO      |   246|   185|         NA|\n|GBA       |   370|   249|          1|\n|NEA       |   269|   179|         NA|\n|NOA       |   284|   162|         NA|\n|PATAGONIA |   253|   186|         NA|\n\n</div>\n:::\n:::\n\n\nLa variable `sexo` no existe como tal sino que se encuentra **repartida a lo ancho de la tabla como columnas** y entonces si nos pasan una tabla como esta no podr铆amos aplicar operaciones como `filter()` y quedarnos s贸lo con las mujeres\n\n## Qu茅 es un pivoteo y en qu茅 situaciones lo voy a necesitar {.smaller}\n\nEl **pivoteo de tablas** es una operaci贸n para **reorganizar la estructura de una tabla**, cambiando la disposici贸n de las filas y columnas. Es como \"girar\" o \"rotar\" la tabla para ver los datos desde otra perspectiva.\n\nDos operaciones clave de pivoteo en `tidyr`:\n\n-   **`pivot_longer()`**: Convierte **columnas \"anchas\" en filas \"largas\"**. \"Alarga\" la tabla. til cuando las categor铆as est谩n como nombres de columnas y queremos tenerlas en una columna *variable*.\n\n-   **`pivot_wider()`**: Convierte **filas \"largas\" en columnas \"anchas\"**. \"Ensancha\" la tabla. Operaci贸n inversa a `pivot_longer()`. til cuando las categor铆as est谩n en una columna *variable* y queremos tenerlas como nombres de columnas.\n\n## Estirar a lo largo con pivot_longer {.smaller}\n\nPara convertir a sexo en columna vamos a usar una funci贸n muy 煤til llamada `pivot_longer`.\n\nPartimos de la tabla resumen de personas por genero y regi贸n que tiene este aspecto\n\n\n::: {.cell}\n\n```{.r .cell-code}\nencc_personas_por_genero_region\n```\n\n::: {.cell-output-display}\n<div class=\"kable-table\">\n\n|region    | Mujer| Var贸n| No binario|\n|:---------|-----:|-----:|----------:|\n|CABA      |   215|   173|         NA|\n|CENTRO    |   368|   240|         NA|\n|CUYO      |   246|   185|         NA|\n|GBA       |   370|   249|          1|\n|NEA       |   269|   179|         NA|\n|NOA       |   284|   162|         NA|\n|PATAGONIA |   253|   186|         NA|\n\n</div>\n:::\n:::\n\n\nEsta tabla esta buena para presentarla en un reporte al p煤blico pero no nos sirve si queremos \"amasarla\" al calor de la transformaci贸n de datos. Necesitamos estirar los datos de las columnas Mujer, Varon y No binario.\n\n## Estirar a lo largo con pivot_longer {.smaller}\n\n::: columns\n::: {.column width=\"50%\"}\nLa funci贸n nos pide al menos **dos argumentos** para operar (adem谩s de la tabla en cuesti贸n, obviamente)\n\n\n::: {.cell}\n\n```{.r .cell-code}\nencc_personas_por_genero_region_alargada <- encc_personas_por_genero_region %>% \n  pivot_longer(\n    # 1. qu茅 columnas pivotear\n    cols = c(\"Mujer\",\"Var贸n\",\"No binario\"), \n    # 2. c贸mo se va a llamar la variable \n    names_to = \"sexo\", \n    # (opcional) donde van a parar los valores alargados\n    values_to = \"personas\" \n    )\n```\n:::\n\n:::\n\n::: {.column width=\"50%\"}\nDe modo que\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhead(encc_personas_por_genero_region_alargada)\n```\n\n::: {.cell-output-display}\n<div class=\"kable-table\">\n\n|region |sexo       | personas|\n|:------|:----------|--------:|\n|CABA   |Mujer      |      215|\n|CABA   |Var贸n      |      173|\n|CABA   |No binario |       NA|\n|CENTRO |Mujer      |      368|\n|CENTRO |Var贸n      |      240|\n|CENTRO |No binario |       NA|\n\n</div>\n:::\n:::\n\n:::\n:::\n\n## Estirar a lo largo con pivot_longer {.smaller}\n\nY ahora ya podemos hacer operaciones con esta tabla como por ejemplo filtrar solo a las muejeres\n\n\n::: {.cell}\n\n```{.r .cell-code}\nencc_personas_por_genero_region_alargada %>% \n  filter(sexo == \"Mujer\")\n```\n\n::: {.cell-output-display}\n<div class=\"kable-table\">\n\n|region    |sexo  | personas|\n|:---------|:-----|--------:|\n|CABA      |Mujer |      215|\n|CENTRO    |Mujer |      368|\n|CUYO      |Mujer |      246|\n|GBA       |Mujer |      370|\n|NEA       |Mujer |      269|\n|NOA       |Mujer |      284|\n|PATAGONIA |Mujer |      253|\n\n</div>\n:::\n:::\n\n\n## Estirar a lo ancho con pivot_wider {.smaller}\n\nPivot wider es (como ya te estaras imaginando) la operaci贸n inversa. Los argumentos de esta funci贸n entonces van a ser\n\n\n::: {.cell}\n\n```{.r .cell-code}\nencc_personas_por_genero_region_alargada %>% \n  pivot_wider(\n    # 1. Nombre de la variable que voy a estirar a lo ancho como columnas\n    names_from = \"sexo\", \n    # 2. Qu茅 variable contiene los valores que debo repartir en las columnas\n    values_from = \"personas\") \n```\n\n::: {.cell-output-display}\n<div class=\"kable-table\">\n\n|region    | Mujer| Var贸n| No binario|\n|:---------|-----:|-----:|----------:|\n|CABA      |   215|   173|         NA|\n|CENTRO    |   368|   240|         NA|\n|CUYO      |   246|   185|         NA|\n|GBA       |   370|   249|          1|\n|NEA       |   269|   179|         NA|\n|NOA       |   284|   162|         NA|\n|PATAGONIA |   253|   186|         NA|\n\n</div>\n:::\n:::\n\n\n::: callout-tip\nSi bien no es una regla, podr铆amos pensar que `pivot_longer()` va a transformar los datos de manera entendible para una m谩quina o para el trabajo con ellos como tablas de manera *tidy*, mientras que `pivot_wider()` siempre nos da un formato\n:::\n\n## 驴Qu茅 aprendimos hasta ac谩?\n\n-   Conocimos algunos de los beneficios de la comunidad de R\n-   Nos zambullimos en R y recorrimos los b谩sicos del IDE RStudio\n-   Aprendimos convenciones y elementos b谩sicos y a importar tablas para trabajar con ellas.\n-   Hicimos nuestro primer viaje al *tidyverso* con los verbos centrales `dplyr()` y los conjugamos entre s铆 con `pipes`\n-   Unimos tablas y las hicimos girar sobre s铆 mismas para poder manipularlas.\n\n## Ahora a practicar!\n\nAhora ya estamos podemos completar nuestro primer trabajo pr谩ctico integrador.\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-after-body": [
        "\n<script>\n  // htmlwidgets need to know to resize themselves when slides are shown/hidden.\n  // Fire the \"slideenter\" event (handled by htmlwidgets.js) when the current\n  // slide changes (different for each slide format).\n  (function () {\n    // dispatch for htmlwidgets\n    function fireSlideEnter() {\n      const event = window.document.createEvent(\"Event\");\n      event.initEvent(\"slideenter\", true, true);\n      window.document.dispatchEvent(event);\n    }\n\n    function fireSlideChanged(previousSlide, currentSlide) {\n      fireSlideEnter();\n\n      // dispatch for shiny\n      if (window.jQuery) {\n        if (previousSlide) {\n          window.jQuery(previousSlide).trigger(\"hidden\");\n        }\n        if (currentSlide) {\n          window.jQuery(currentSlide).trigger(\"shown\");\n        }\n      }\n    }\n\n    // hookup for slidy\n    if (window.w3c_slidy) {\n      window.w3c_slidy.add_observer(function (slide_num) {\n        // slide_num starts at position 1\n        fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);\n      });\n    }\n\n  })();\n</script>\n\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}